<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<head>
  <title>Java-Success Blog: Article: Scenarios and solutions for better concurrency and thread safety part-1 ReadWriteLocks</title>

  <link href='http://www.java-success.com' rel='canonical'/>

  


  <script type="text/javascript">(function() { (function(){function c(a){this.t={};this.tick=function(a,c,b){var d=void 0!=b?b:(new Date).getTime();this.t[a]=[d,c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(l){}};this.tick("start",null,a)}var a,e;window.performance&&(e=(a=window.performance.timing)&&a.responseStart);var h=0<e?new c(e):new c;window.jstiming={Timer:c,load:h};if(a){var b=a.navigationStart;0<b&&e>=b&&(window.jstiming.srt=e-b)}if(a){var d=window.jstiming.load;0<b&&e>=b&&(d.tick("_wtsrt",void 0,b),d.tick("wtsrt_","_wtsrt",
e),d.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),d&&0<b&&(d.tick("_tbnd",void 0,window.chrome.csi().startE),d.tick("tbnd_","_tbnd",b))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,d&&0<b&&(d.tick("_tbnd",void 0,window.external.startE),d.tick("tbnd_","_tbnd",b))),a&&(window.jstiming.pt=a)}catch(k){}})();window.tickAboveFold=function(c){var a=0;if(c.offsetParent){do a+=c.offsetTop;while(c=c.offsetParent)}c=a;750>=c&&window.jstiming.load.tick("aft")};var f=!1;function g(){f||(f=!0,window.jstiming.load.tick("firstScrollTime"))}window.addEventListener?window.addEventListener("scroll",g,!1):window.attachEvent("onscroll",g);
 })();</script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Blogger" />
<link rel="icon" type="image/vnd.microsoft.icon" href="https://www.blogger.com/favicon.ico"/>
<link rel="alternate" type="application/atom+xml" title="Java-Success Blog - Atom" href="http://java-success.blogspot.com/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Java-Success Blog - RSS" href="http://java-success.blogspot.com/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Java-Success Blog - Atom" href="https://www.blogger.com/feeds/35897879/posts/default" />
<link rel="alternate" type="application/atom+xml" title="Java-Success Blog - Atom" href="http://java-success.blogspot.com/feeds/2523435996461446565/comments/default" />
<link rel="stylesheet" type="text/css" href="https://www.blogger.com/static/v1/v-css/50269083-blog_controls.css"/>
<link rel="stylesheet" type="text/css" href="https://www.blogger.com/dyn-css/authorization.css?targetBlogID=35897879&zx=32ffd7df-5810-469f-a666-048e5011b3eb"/>
<script type="text/javascript" src="https://www.blogger.com/static/v1/v-js/979395223-backlink.js"></script>
<script type="text/javascript" src="https://www.blogger.com/static/v1/v-js/4080670514-backlink_control.js"></script>
<script type="text/javascript">var BL_backlinkURL = "https://www.blogger.com/dyn-js/backlink_count.js";var BL_blogId = "35897879";</script>


  <style type="text/css">
/*
-----------------------------------------------
Blogger Template Style
Name:     Harbor
Designer: Douglas Bowman
URL:      www.stopdesign.com
Date:     24 Feb 2004
----------------------------------------------- */


body {
  background:#fff url("http://www.blogblog.com/harbor/rocks.jpg") no-repeat right bottom;
  background-attachment:fixed;
  margin:0;
  padding:0;
  font:x-small Georgia,Serif;
  color:#333;
  font-size/* */:/**/small;
  font-size: /**/small;
  }
/* Commented Backslash Hack hides rule from IE5-Mac \*/
  body {background-attachment:scroll;}
  /* End IE5-Mac hack */
a:link {
  color:#36a;
  text-decoration:none;
  }
a:visited {
  color:#764;
  text-decoration:none;
  }
a:hover {
  color:#933;
  text-decoration:underline;
  }
a img {
  border-width:0;
  }


/* Page Structure
----------------------------------------------- */
#wrap {
  background:url("http://www.blogblog.com/harbor/sky.jpg") repeat-x left top;
  min-width:740px;
  margin:0;
  padding:0;
  text-align:left;
  }
#wrap2 {
  background:url("http://www.blogblog.com/harbor/lighthouse.jpg") no-repeat left top;
  }
#wrap3 {
  background:url("http://www.blogblog.com/harbor/cloud.jpg") no-repeat 100% 75px;
  }
#wrap4 {
  background:url("http://www.blogblog.com/harbor/center_cloud.jpg") no-repeat 50% 0;
  padding:15px;
  width:100%;
  width/* */:/**/auto;
  width: /**/auto;
  }
@media all {
  #content {
    max-width:890px;
    padding:0 30px 50px;
    width:100%;
    width/* */:/**/auto;
    width: /**/auto;
    }
  html>body #content {
    border:3px double #fff;
    }
  #main {
    width:64%;
    float:right;
    }
  #main2 {
    margin:0;
    padding:0;
    }
  #sidebar {
    width:32%;
    float:left;
    }
  #sidebar2 {
    margin:0;
    padding:170px 0 20px;
    }
  }
@media handheld {
  #content {
    width:90%;
    }
  #main {
    width:100%;
    float:none;
    }
  #sidebar {
    width:100%;
    float:none;
    }
  }

/* Header
----------------------------------------------- */
@media all {
  #header {
    padding:15px 0 10px 110px;
    }
  }
@media handheld {
  #header {
    width:100%;
    padding:15px 0 10px 0;
    }
  }
#blog-title {
  margin:0 0 .25em;
  font-size:270%;
  font-weight:normal;
  color:#678;
  }
#blog-title a {
  color:#678;
  text-decoration:none;
  }
#description {
  margin:0;
  max-width:700px;
  font-size:75%;
  line-height:1.8em;
  text-transform:uppercase;
  letter-spacing:.2em;
  color:#789;
  }


/* Headings
----------------------------------------------- */
h2 {
  margin:1.5em 0 .75em;
  font:78%/1.4em Georgia,Serif;
  text-transform:uppercase;
  letter-spacing:.2em;
  color:#933;
  }


/* Posts
----------------------------------------------- */
.date-header {
  margin:2em 0 .5em;
  }
.post {
  margin:.5em 0 1.5em;
  line-height:1.6em;
  }
.post-title {
  margin:.25em 0 0;
  padding:0 0 4px;
  font-size:140%;
  font-weight:normal;
  line-height:1.4em;
  }
.post-title a, .post-title strong {
  background:url("http://www.blogblog.com/harbor/icon_lighthouse.gif") no-repeat 0 .15em;
  display:block;
  padding-left:20px;
  text-decoration:none;
  color:#368;
  font-weight:normal;
  }
.post-title strong {
  background-image:url("http://www.blogblog.com/harbor/icon_lighthouse2.gif");
  color:#000;
  }
.post-title a:hover {
  color:#933;
  }
.post-body {
  background:url("http://www.blogblog.com/harbor/divider.gif") no-repeat center top;
  padding-top:12px;
  }
.post p {
  margin:0 0 .75em;
  }
p.post-footer {
  color:#999;
  }
.post-footer em, .comment-link {
  font:78%/1.4em Georgia,Serif;
  text-transform:uppercase;
  letter-spacing:.1em;
  }
.post-footer em {
  font-style:normal;
  color:#666;
  margin-right:.4em;
  }
.comment-link strong {
  font-size:130%;
  }
.comment-link {
  margin-left:.4em;
  }
.post img {
  padding:4px;
  border:1px solid #cde;
  }


/* Comments
----------------------------------------------- */
#comments {
  background:url("http://www.blogblog.com/harbor/divider.gif") no-repeat center top;
  padding:15px 0 0;
  }
#comments h4 {
  margin:1em 0;
  font:bold 78%/1.6em Georgia,Serif;
  text-transform:uppercase;
  letter-spacing:.2em;
  color:#933;
  }
#comments h4 strong {
  font-size:130%;
  }
#comments-block {
  margin:1em 0 1.5em;
  line-height:1.4em;
  }
#comments-block dt {
  margin:.5em 0;
  }
#comments-block dd {
  margin:.25em 20px 0;
  }
#comments-block dd.comment-timestamp {
  margin:-.25em 20px 1.5em;
  font:78%/1.4em Georgia,Serif;
  text-transform:uppercase;
  letter-spacing:.1em;
  }
#comments-block dd p {
  margin:0 0 .75em;
  }
.deleted-comment {
  font-style:italic;
  color:gray;
  }


/* Sidebar Content
----------------------------------------------- */
#sidebar ul {
  background:url("http://www.blogblog.com/harbor/divider.gif") no-repeat center bottom;
  margin:0 0 15px;
  padding:0 0 15px;
  list-style:none;
  }
#sidebar li {
  margin:0;
  padding:0 0 .25em 15px;
  text-indent:-15px;
  line-height:1.5em;
  }
#sidebar p {
  color:#666;
  line-height:1.5em;
  }


/* Profile
----------------------------------------------- */
#profile-container {
  background:url("http://www.blogblog.com/harbor/divider.gif") no-repeat center bottom;
  margin:0 0 2em;
  padding:0 0 15px;
  }
.profile-datablock {
  margin:.5em 0 .5em;
  }
.profile-img {
  display:inline;
  }
.profile-img img {
  float:left;
  padding:4px;
  border:1px solid #cde;
  margin:0 8px 3px 0;
  }
.profile-data {
  margin:0;
  font:bold 78%/1.6em Georgia,Serif;
  text-transform:uppercase;
  letter-spacing:.1em;
  }
.profile-data strong {
  display:none;
  }
.profile-textblock {
  margin:0 0 .5em;
  }
.profile-link {
  font:78%/1.4em Georgia,Serif;
  text-transform:uppercase;
  letter-spacing:.1em;
  }


/* Footer
----------------------------------------------- */
#footer {
  clear:both;
  padding:15px 30px 0 50px;
  }
#footer hr {
  display:none;
  }
#footer p {
  background:url("http://www.blogblog.com/harbor/divider.gif") no-repeat center top;
  margin:0;
  padding-top:15px;
  font:78%/1.6em Georgia,Serif;
  text-transform:uppercase;
  letter-spacing:.1em;
  }


/* Feeds
----------------------------------------------- */
#blogfeeds {
  }
#postfeeds {
  }
  </style>
<!-- --><style type="text/css">@import url(https://www.blogger.com/static/v1/v-css/navbar/3334278262-classic.css);
div.b-mobile {display:none;}
</style>

</head>

<body><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar.g?targetBlogID\x3d35897879\x26blogName\x3dJava-Success+Blog\x26publishMode\x3dPUBLISH_MODE_BLOGSPOT\x26navbarType\x3dBLUE\x26layoutType\x3dCLASSIC\x26searchRoot\x3dhttp://java-success.blogspot.com/search\x26blogLocale\x3den\x26v\x3d2\x26homepageUrl\x3dhttp://java-success.blogspot.com/\x26vt\x3d2978101103701820782',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script>

<!-- Begin wraps -->

<div id="wrap"><div id="wrap2"><div id="wrap3"><div id="wrap4">


<!-- Begin #content -->
<div id="content">


<div id="header">

  <h1 id="blog-title">
    <a href="http://java-success.blogspot.in/">
	Java-Success Blog
	</a>
  </h1>

  <p id="description">Java/JEE blog containing interview questions and answers and tutorials</p>

</div>


<!-- Begin #main -->
<div id="main"><div id="main2">

<div class='adsense' style='text-align:center; padding: 0px 3px 0.5em 3px;'>
<script type="text/javascript"><!--
google_ad_client="pub-3764234023451771";
google_ad_host="pub-1556223355139109";
google_ad_width=468;
google_ad_height=60;
google_ad_format="468x60_as";
google_ad_type="text";
google_color_border="FFFFFF";
google_color_bg="FFFFFF";
google_color_link="333333";
google_color_url="009900";
google_color_text="993333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>



</div>

<!-- Search Google -->
<center>
<form method="get" action="http://www.google.com/custom" target="_top">
<table bgcolor="#ffffff">
<tr><td nowrap="nowrap" valign="top" align="left" height="32">
<a href="http://www.google.com/">
<img src="http://www.google.com/logos/Logo_25wht.gif" border="0" alt="Google" align="middle"></img></a>
<label for="sbi" style="display: none">Enter your search terms</label>
<input type="text" name="q" size="31" maxlength="255" value="" id="sbi"></input>
<label for="sbb" style="display: none">Submit search form</label>
<input type="submit" name="sa" value="Search" id="sbb"></input>
<input type="hidden" name="client" value="pub-3764234023451771"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:336699;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;FORID:1"></input>
<input type="hidden" name="hl" value="en"></input>
</td></tr></table>
</form>
</center>
<!-- Search Google -->









<script type="text/javascript"><!--
google_ad_client = "pub-3764234023451771";
google_ad_host = "pub-1556223355139109";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
//-->
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>


  <h2 class="date-header">Aug 20, 2012</h2>

  
  
     
  <!-- Begin .post -->
  <div class="post"><a name="2523435996461446565"></a>
    
         
    


    <h3 class="post-title">
	 
	 Article: Scenarios and solutions for better concurrency and thread safety part-1 ReadWriteLocks
	 
    </h3>

    
     
    <div class="post-body">
    <p>
      <div style="clear:both;"></div><span style="font-size: large;"><b>Scenario</b>:</span> You need to load &nbsp;stock exchange security codes from a database and cache them for performance. The security codes need to be refreshed say every 30 minutes. This cached data needs to be populated and refreshed by a single writer thread and read by several reader threads. How will you ensure that your read/write solution is <b>scalable </b>and <b>thread safe</b>?<br />
<br />
<b><span style="font-size: large;">Solution</span></b>: &nbsp;The<b> java.util.concurrent.locks </b>package provides classes that implement read/write locks where the read lock can be executed in parallel by multiple threads and the write lock can be held by only a single thread. The <b><i>ReadWriteLock </i></b>interface maintains a pair of associated locks, one for read-only and one for writing. The readLock( ) may be held simultaneously by multiple reader threads, while the writeLock( ) is exclusive. In general, this implementation <b>improves performance and scalability</b> when compared to the mutex locks (i.e. via synchronized key word) when<br />
<br />
<ul>
<li>there are more reads and read duration compared writes and write duration.&nbsp;</li>
<li>It also depends on the system you are running on -- for example multi-core processors for better parallelism.&nbsp;</li>
</ul>
<br />
The <i><b>ConcurrentHashmap </b></i>is another example where improved performance can be achieved when you have more reads than writes. The <b><i>ConcurrentHashmap </i></b>allows concurrent reads and locks only the buckets that are used to modify or insert data.<br />
<br />
Here are a few terminlogies you need to be familiar with in implementing locks.<br />
<br />
<table>

<tbody>
<tr>

<td width="35%"><script type="text/javascript"><!--
google_ad_client = "ca-pub-3764234023451771";
/* LHS - vertical bar */
google_ad_slot = "9570018680";
google_ad_width = 160;
google_ad_height = 600;
google_ad_channel ="9570018680";
//-->
</script>
<script src="http://pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>

</td>

<td width="75%"><b>Q.</b> What is a reentrant lock?<br />
<b>A.</b> This can be considered as a replacement for the traditional “wait-notify” method. The basic concept is, every thread needs to acquire the lock before entering in to the critical section and should release it after finishing it. ReentrantLock eliminates the use of “synchronized” keyword to provide better concurrency<br />
<br />
The term reentrant means if a thread enters a second synchronized block protected by a monitor that the thread already owns from , the thread will be allowed to proceed, and the lock will not be released when the thread exits the second (or subsequent) synchronized block, but only will be released when it exits the first synchronized block it entered protected by that monitor. Similarly, when you use reentrant locks, there will be an acquisition count associated with the lock, and if a thread that holds the lock acquires it again, the acquisition count is incremented and the lock then needs to be released twice to truly release the lock. &nbsp;A writer can acquire the read lock - but the reverse is not true. If a reader tries to acquire the write lock it will never succeed.<br />
<br />
<b>Q. </b>What do you need to watch out for in releasing a lock?<br />
<b>A.</b> The locks need to be released in a finally block, otherwise if an exception is thrown, the lock might never get released.<br />
<br />
<b>Q. </b>Why would you need a reentrant lock when there is synchronized keyword? How will you favor one over the other?<br />
<b>A. </b>The reentrant locks are more scalable as it allows concurrent reads. Having said this, the locking classes in java.util.concurrent.lock package are advanced tools for advanced users and specific situations like the scenario discussed above. In general, you should stick with synchronization unless you have a specific need &nbsp;like<br />
<ul>
<li>the number of reads are far more than the number of writes.&nbsp;</li>
<li>demonstrated evidence through proper performance testing that synchronization in a specific situation is a scalability bottleneck.&nbsp;</li>
<li>specif features like timed lock waits, interruptible lock waits, non-block-structured locks, multiple condition variables, or lock polling are required.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<br />
<b>Q. </b>What are <b>fair </b>and <b>unfair </b>locks?<br />
<b>A.</b> One of the arguments to the constructor of <b>ReentrantLock </b>is a boolean value that lets you choose whether you want a fair or an unfair lock. A fair lock is one where the threads acquire the lock in the same order they asked for it. In another words, when the write lock is released either the longest-waiting single writer will be assigned the write lock, or if there is a reader waiting longer than any writer, the set of readers will be assigned the read lock. When constructed as non-fair, the order of entry to the lock are not necessarily in the arrival order.<br />
If the readers are active and a writer enters the lock then no subsequent readers will be granted the read lock until after that writer has acquired and released the write lock. Here is a simplified example of read/write locks.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="http://2.bp.blogspot.com/-fc3iwtN-3g0/UDHhCKwhEiI/AAAAAAAAAtE/dvmY2F9jcrI/s1600/read-write-thread-locks.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="355" src="http://2.bp.blogspot.com/-fc3iwtN-3g0/UDHhCKwhEiI/AAAAAAAAAtE/dvmY2F9jcrI/s640/read-write-thread-locks.jpg" width="640" /></a></div>
<br />
<br />
Firstly, define the <b><i>SharedData </i></b>that gets accessed by multiple reader and writer threads. So, provide proper locks.
<br />
<!-- INFOLINKS_OFF -->
<br />
<pre class="brush: csharp">import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.locks.ReentrantReadWriteLock;


public class SharedData&lt;T&gt; {
 
 private List&lt;Integer&gt; numbers = new ArrayList&lt;Integer&gt;(20);
 private ReentrantReadWriteLock lock = new ReentrantReadWriteLock();

 public List&lt;Integer&gt; getTechnologies() {
  return numbers;
 }
 
 public void writeData(Integer number) {
  String threadName = Thread.currentThread().getName();
  lock.writeLock().lock(); //acquire a write lock if no other thread has acquired read/write lock
                           //only a single thread can write
  
  System.out.println("threads waiting for read/write lock: " + lock.getQueueLength());
  // This should be always one
  System.out.println("writer locks held " + lock.getWriteHoldCount());
  try {
   numbers.add(number);
   System.out.println("&gt;&gt;&gt;&gt;&gt;" + threadName + " writing: " + number);
   Thread.sleep(2000);    // sleep for 2 seconds to demo read/write locks
  } catch (InterruptedException e) {
   e.printStackTrace();
  } finally {
   System.out.println(threadName + " releasing write lock");
   lock.writeLock().unlock();  //lock will be released
  }
 }
 
 public void readData() {
    String threadName = Thread.currentThread().getName();
    lock.readLock().lock();//acquire a read lock if no other thread has acquired a write lock.
                           //concurrent reads allowed.
    
    System.out.println("threads waiting for read/write lock: " + lock.getQueueLength());
    System.out.println("reader locks held "  + lock.getReadLockCount());
    try {
   for (Integer num: numbers) {
    System.out.println("&lt;&lt;&lt;&lt;&lt;&lt;&lt;" + threadName + " reading: " + num);
   } 
      Thread.sleep(1000);
    } catch (InterruptedException e) {
      e.printStackTrace();
    }
    finally{
     System.out.println(threadName + " releasing read lock");
     lock.readLock().unlock();  //lock will be released
    }
    
  }
}
</pre>
<br />
<br />
Next, define the <b>reader </b>and <b>writer </b>threads. 
<br />
<br />
<pre class="brush: csharp">public class Reader&lt;T&gt; extends Thread {
 
 private SharedData&lt;T&gt; sharedData;
 
 public Reader(SharedData&lt;T&gt; sharedData) {
  this.sharedData = sharedData;
 }

 @Override
 public void run() {
  sharedData.readData();
 }
}
</pre>
<br />
<br />
<pre class="brush: csharp">public class Writer&lt;T&gt; extends Thread {
 
 private boolean oddNumber = true;
 private SharedData&lt;T&gt; sharedData;
 
 public Writer(SharedData&lt;T&gt; sharedData, boolean oddNumber ) {
  this.sharedData = sharedData;
  this.oddNumber = oddNumber;
 }

 @Override
 public void run() {
  for(int i=1; i&lt;=2; i++) {
   if(!oddNumber &amp;&amp; i%2 == 0) {
      sharedData.writeData(i);
   }
   else if (oddNumber &amp;&amp; !(i%2 == 0)){
      sharedData.writeData(i); 
   }
  }
 }
}
</pre>
<br />
<br />
Finally, the <b>ReadWriteProcessor </b>class that spawns thw worker read and write threads and pass the SharedData to the threads.
<br />
<br />
<pre class="brush: csharp">public class ReadWriteProcessor {
 
 public static void main(String[] args) throws Exception {
  
  SharedData&lt;Integer&gt; data = new SharedData&lt;Integer&gt;();
  
  //create some writer worker threads
  Writer&lt;Integer&gt; oddWriter = new Writer&lt;Integer&gt;(data, true);
  oddWriter.setName("oddWriter");
  Writer&lt;Integer&gt; evenWriter = new Writer&lt;Integer&gt;(data, false);
  evenWriter.setName("evenWriter");
  
  //create some reader worker threads
  Reader&lt;Integer&gt; reader1 = new Reader&lt;Integer&gt;(data);
  reader1.setName("reader1");
  Reader&lt;Integer&gt; reader2 = new Reader&lt;Integer&gt;(data);
  reader2.setName("reader2");
  Reader&lt;Integer&gt; reader3 = new Reader&lt;Integer&gt;(data);
  reader3.setName("reader3");
  
  //start the writer threads
  oddWriter.start();
  Thread.sleep(100);
  evenWriter.start();
  
  //start the reader threads
  reader1.start(); 
  reader2.start();
  reader3.start();
 }
}
</pre>
<br />
<br />
The output will be something like:

<br />
<br />
<pre class="brush: csharp">threads waiting for read/write lock: 0
writer locks held 1
&gt;&gt;&gt;&gt;&gt;oddWriter writing: 1
oddWriter releasing write lock
threads waiting for read/write lock: 3
writer locks held 1
&gt;&gt;&gt;&gt;&gt;evenWriter writing: 2
evenWriter releasing write lock
threads waiting for read/write lock: 2
threads waiting for read/write lock: 1
reader locks held 3
threads waiting for read/write lock: 0
reader locks held 3
reader locks held 2
&lt;&lt;&lt;&lt;&lt;&lt;&lt;reader1 reading: 1
&lt;&lt;&lt;&lt;&lt;&lt;&lt;reader2 reading: 1
&lt;&lt;&lt;&lt;&lt;&lt;&lt;reader3 reading: 1
&lt;&lt;&lt;&lt;&lt;&lt;&lt;reader2 reading: 2
&lt;&lt;&lt;&lt;&lt;&lt;&lt;reader1 reading: 2
&lt;&lt;&lt;&lt;&lt;&lt;&lt;reader3 reading: 2
reader1 releasing read lock
reader3 releasing read lock
reader2 releasing read lock
</pre>
<br />
<br />
There are other<b> real life scenarios </b>where the java.util.concurrent package with the following classes can be put to great use.<br />
<ul>
<li><b>CountDownLatch</b></li>
<li><b>CyclicBarrier</b></li>
<li><b>Semaphore</b></li>
<li><b>Atomic </b>classes</li>
</ul>
<br />
The real life scenarios with solution will be discussed in the ensuing parts.<br />
<br />
<ul>
<li><a href="http://java-success.blogspot.com.au/2012/08/article-scenarios-and-solutions-for_21.html">Article: Scenarios and solutions for better concurrency and thread safety part-2 CountDownLatch and CyclicBarrier</a></li>
<li><a href="http://java-success.blogspot.com.au/2012/08/article-scenarios-and-solutions-for_28.html" target="_blank">Article:&nbsp;Scenarios and solutions for better concurrency and thread safety part-3 Semaphores and mutexes</a></li>
</ul>
<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://java-success.blogspot.com/search/label/Multi-threading">Multi-threading</a></p>
    </p>
    </div>
    
    <p class="post-footer">
      <em>posted by Arulkumaran Kumaraswamipillai at 
    <a class="post-footer-link" href="http://java-success.blogspot.in/2012/08/article-scenarios-and-solutions-for.html" title="permanent link"> 8/20/2012 05:09:00 PM </a></em>

        <span class="item-action"><a href="https://www.blogger.com/email-post.g?blogID=35897879&postID=2523435996461446565" title="Email Post"><img class="icon-action" alt="" src="https://img2.blogblog.com/img/icon18_email.gif" height="13" width="18"/></a></span><span class="item-control blog-admin pid-341905326"><a style="border:none;" href="https://www.blogger.com/post-edit.g?blogID=35897879&postID=2523435996461446565&from=pencil" title="Edit Post"><img class="icon-action" alt="" src="https://img2.blogblog.com/img/icon18_edit_allbkg.gif" height="18" width="18"></a></span>
    </p>
  
  </div>
  <!-- End .post -->
  
  
  
  <!-- Begin #comments -->
 

  <div id="comments">

	<a name="comments"></a>
    
    <h4>0 Comments:</h4>
    
    <dl id="comments-block">
      
    </dl>

    
   <p class="comment-timestamp">
    <div class='comment-form'>
<a name='comment-form'></a>
<h4>Post a Comment</h4><p></p>
<a id='comment-editor-src' href='https://www.blogger.com/comment-iframe.g?blogID=35897879&postID=2523435996461446565'></a><iframe id='comment-editor' src='' class='blogger-iframe-colorize' width='100%' height='410' scrolling='no' frameborder='0' allowtransparency='true'></iframe>
<script type="text/javascript" src="https://www.blogger.com/static/v1/jsbin/2702546152-iframe_colorizer.js"></script>
</div>
    </p>
    <p id="postfeeds">Subscribe to Post Comments [<a target="_blank" href="http://java-success.blogspot.com/feeds/2523435996461446565/comments/default" type="application/atom+xml">Atom</a>]</p>
    	    
    


		<p class="comment-timestamp">
	<a href="http://java-success.blogspot.in/">&lt;&lt; Home</a>
    </p>
    </div>


  <!-- End #comments -->
   

</div></div>
<!-- End #main -->







<!-- Begin #sidebar -->
<div id="sidebar"><div id="sidebar2">

  
  
  <h2 class="sidebar-title">Previous Posts</h2>
    <ul id="recently">
    
        <li><a href="http://java-success.blogspot.in/2012/08/article-sample-java-resume-or-sample.html">Article: Sample Java Resume or CV</a></li>
     
        <li><a href="http://java-success.blogspot.in/2012/08/article-using-builders-instead-of.html">Article: Using Builders instead of Constructors to...</a></li>
     
        <li><a href="http://java-success.blogspot.in/2012/08/article-functional-programming-in-java.html">Article: Functional programming in Java</a></li>
     
        <li><a href="http://java-success.blogspot.in/2012/08/java-logical-thinking-code-example.html">Java logical thinking and coding questions and ans...</a></li>
     
        <li><a href="http://java-success.blogspot.in/2012/08/how-to-standout-from-other-javajee.html">How to standout from other Java/JEE professionals?...</a></li>
     
        <li><a href="http://java-success.blogspot.in/2012/08/html-and-css-interview-questions-and.html">HTML and CSS Interview Questions and Answers</a></li>
     
        <li><a href="http://java-success.blogspot.in/2012/07/javascript-common-mistakes-and-tools.html">JavaScript common mistakes and  tools</a></li>
     
        <li><a href="http://java-success.blogspot.in/2012/07/sql-interview-questions-and-answers.html">SQL Interview Questions and Answers: storing a tre...</a></li>
     
        <li><a href="http://java-success.blogspot.in/2012/07/uml-diagrams-interview-questions-and.html">UML diagrams interview questions and answers</a></li>
     
        <li><a href="http://java-success.blogspot.in/2012/07/java-coding-question-on-popular.html">Java coding question on the popular Fibonacci sequ...</a></li>
     
  </ul>
  
  
  
  
  
  <!-- Begin #profile-container -->
  
    <div id="profile-container"><h2 class="sidebar-title">About Me</h2>
<dl class="profile-datablock"><dt class="profile-img"><a href="https://plus.google.com/109240621969095737337"><img src="//lh3.googleusercontent.com/-XMLxx0v_R7A/AAAAAAAAAAI/AAAAAAAACxk/8BeHFmsEuy8/s80-c/photo.jpg" width="80" height="80" alt="My Photo"></a></dt>
<dd class="profile-data"><strong>Name:</strong> <a rel="author" href="https://plus.google.com/109240621969095737337"> Arulkumaran Kumaraswamipillai </a></dd>
</dl>
<p class="profile-textblock">Java freelancer from Australia. As a contractor, attended 100+ job interviews and received multiple job offers. Authored Java career books that sold over 30,000 copies.<br><br><a href="http://www.java-success.com" rel="nofollow" target="_blank">www.java-success.com</a> for 500+ Java/JEE job interview questions and answers and tutorials.<br></p>
<p class="profile-link"><a rel="author" href="https://plus.google.com/109240621969095737337">View my complete profile</a></p></div>
  
  <!-- End #profile -->

  
  <p id="powered-by"><a href="http://www.blogger.com"><img src="http://buttons.blogger.com/bloggerbutton1.gif" alt="Powered by Blogger" /></a></p>
  <p id="blogfeeds">Subscribe to<br />Posts [<a target="_blank" href="http://java-success.blogspot.com/feeds/posts/default" type="application/atom+xml">Atom</a>]</p>

  <script type="text/javascript"><!--
google_ad_client = "pub-3764234023451771";
google_ad_host = "pub-1556223355139109";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>  
   
  <!--
  <p>This is a paragraph of text that could go in the sidebar.</p>
  -->
  
  <script type="text/javascript"><!--
google_ad_client = "pub-3764234023451771";
google_ad_host = "pub-1556223355139109";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
//-->
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>  



</div></div>
<!-- End #sidebar -->




<!-- Begin #footer -->
<div id="footer"><hr />

  <p><!-- This is an optional footer. If you want text here, place it inside these tags, and remove this comment. -->&nbsp;</p>

  </div>
<!-- End #footer -->




</div>
<!-- End #content -->






</div></div></div></div>
<!-- End wraps -->

</body>
</html>